version: 2
jobs:
 build_dev:
  docker:
   - image: circleci/node:latest
  steps:
  - checkout
  - run:
     name: Set APIENDPOINT 
     environment:
      APIENDPOINT: $APIENDPOINT_DEV
  - run:
     name: Update npm
     command: 'sudo npm install'
  - run:
     name: Install ember globally
     command: 'sudo npm install -g ember-cli'
  - run:
     name: Run ember build
     command: 'sudo npm run build'
  - run:
     name: Deploy app
     command: ./node_modules/.bin/surge dist --domain $SURGE_DOMAIN_DEV

 build_PROD:
   docker:
   - image: circleci/node:latest
   steps:
    - checkout
    - run:
       name: Set APIENDPOINT 
       environment:
         APIENDPOINT: $APIENDPOINT_PROD
    - run:
       name: Update npm
       command: 'sudo npm install'
    - run:
       name: Install ember globally
       command: 'sudo npm install -g ember-cli'
    - run:
       name: Run ember build
       command: 'sudo npm run build'
    - run:
       name: Deploy app
       command: ./node_modules/.bin/surge dist --domain $SURGE_DOMAIN_PROD
  
workflows:
  version: 2
  deploy_dev:
    jobs:
      - build_dev
         filters:
            branches:
              ignore: master
      
  deploy_prod:
    jobs:
      - build_PROD
         filters:
            branches:
              only: master

